<!DOCTYPE html>

<html>

    <head>
        <meta charset="UTF-8" />
        <title>Proxyfied Requests - Obsidian HTTP Request</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
            <link rel="shortcut icon" type="image/png" href="images/obsidian-http-request-logo.svg" />
        
        
            <link type="text/css" rel="stylesheet" href="style/gruvbox-dark.css" />
        
            <link type="text/css" rel="stylesheet" href="style/obsidian.css" />
        
    </head>

    <body class=" page-with-nav">

        <div class="page">

            
                <div id="toggle-mobile-menu" title="Toggle menu">â˜°</div>
            

            
                <nav class="links">
                    <ul>
                        <li><a href="https://github.com/wanadev/obsidian-http-request">Github</a></li><li><a href="https://www.npmjs.com/package/obsidian-http-request">NPM</a></li>
                    </ul>
                </nav>
            

            <header>
                <h1>
                    
                        <img src="images/obsidian-http-request-logo.svg"  alt="Obsidian HTTP Request logo" />
                    
                    <span>Obsidian HTTP Request</span>
                </h1>
            </header>

            <div class="content">

                
                    <nav>
                        
                            

    <ul class="menu">
        
            
            <li>
                <a href="index.html" >Home</a>
                
            </li>
        
            
            <li>
                <a href="direct-requests.html" >Direct Requests</a>
                
            </li>
        
            
            <li>
                <a href="proxyfied-requests.html" class="active">Proxyfied Requests</a>
                
                    

    
    <ul class="toc">
        
            <li>
                <a href="#proxy-server">Proxy Server</a>
                
                    
    <ul class="toc">
        
            <li>
                <a href="#implementing-the-proxy-server">Implementing The Proxy Server</a>
                
            </li>
        
            <li>
                <a href="#proxy-status-code">Proxy Status Code</a>
                
            </li>
        
    </ul>

                
            </li>
        
            <li>
                <a href="#client-side-configuration">Client-Side Configuration</a>
                
            </li>
        
            <li>
                <a href="#simple-requests-http-get">Simple Requests (HTTP GET)</a>
                
                    
    <ul class="toc">
        
            <li>
                <a href="#httprequestgettextproxy">httpRequest.getTextProxy</a>
                
            </li>
        
            <li>
                <a href="#httprequestgetjsonproxy">httpRequest.getJsonProxy</a>
                
            </li>
        
            <li>
                <a href="#httprequestgetrawproxy">httpRequest.getRawProxy</a>
                
            </li>
        
            <li>
                <a href="#httprequestgetblobproxy">httpRequest.getBlobProxy</a>
                
            </li>
        
    </ul>

                
            </li>
        
            <li>
                <a href="#advanced-requests">Advanced Requests</a>
                
            </li>
        
            <li>
                <a href="#catching-errors">Catching errors</a>
                
            </li>
        
    </ul>



                
            </li>
        
            
            <li>
                <a href="faq.html" >FAQ</a>
                
            </li>
        
    </ul>


                        
                    </nav>
                
                <article>
                    <h1 id="proxyfied-requests">Proxyfied Requests</h1>
<p>Proxyfied Request are HTTP requests that are sent to a proxy server that will
forward them to the destination server. This can be useful when you want to
retrieve assets from random sites and avoid CORS.</p>
<h2 id="proxy-server">Proxy Server</h2>
<p>To use proxyfied requests, your server must run a proxy that must be accessible
on the <strong>same origin</strong> (same domain, port and protocol) as the application
page.</p>
<p>Obsidian Proxy Server is not a standalone application but a middleware that can
be used with <a href="http://expressjs.com/">Express</a>.</p>
<h3 id="implementing-the-proxy-server">Implementing The Proxy Server</h3>
<p>To implement this server in your application, you first have to install the
required dependencies:</p>
<pre><code class="hljs sh">npm install --save obsidian-http-request express body-parser</code></pre>

<p>Then you can use the proxy middleware in your Express application:</p>
<pre><code class="hljs javascript"><span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">"body-parser"</span>);
<span class="hljs-keyword">const</span> proxyMiddleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">"obsidian-http-request/server/http-proxy"</span>);

<span class="hljs-keyword">const</span> PORT = process.env.PORT || <span class="hljs-number">3042</span>;

<span class="hljs-keyword">const</span> app = express();

app.use(<span class="hljs-string">"/proxy"</span>, bodyParser.raw({<span class="hljs-attr">type</span>: <span class="hljs-string">"application/json"</span>}));
app.use(<span class="hljs-string">"/proxy"</span>, proxyMiddleware({
    <span class="hljs-attr">maxContentLength</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,  <span class="hljs-comment">// Allows to transfer files of 5 MiB max</span>
    allowedPorts: [<span class="hljs-number">80</span>, <span class="hljs-number">443</span>],            <span class="hljs-comment">// Allows to download from ports 80 (http) and 443 (https)</span>
    allowedMethods: [<span class="hljs-string">"GET"</span>]             <span class="hljs-comment">// Allows to forward only GET requests</span>
}));

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Starting Obsidian Proxy Server on 0.0.0.0:<span class="hljs-subst">${PORT}</span>`</span>);
app.listen(PORT);</code></pre>

<p><strong>NOTE:</strong> By default the client library assumes that the proxy URL is <code>/proxy</code>.
If you change this route, you will have to configure it on the client side.</p>
<p>Finally, to run the server you can simply run the previous script using Node:</p>
<pre><code class="hljs sh">node server.js</code></pre>

<p><strong>NOTE:</strong> for a production environment you will probably want to use a <a href="http://expressjs.com/en/advanced/pm.html">process
manager</a> to run the server-side application.</p>
<h3 id="proxy-status-code">Proxy Status Code</h3>
<p>When the proxy operates, it can return various HTTP status code depending on
the request and encountered errors:</p>
<table>
<thead>
<tr>
<th>Status</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>Ok</td>
</tr>
<tr>
<td>400</td>
<td>Bad Request: this code is used in several cases: <ul><li>when you make a request with a wrong protocol (other than <code>http</code> and <code>https</code>),</li><li>when you try to make a request on a port that is not in the server&#39;s <code>allowedPorts</code> list,</li><li>when the request made to the proxy is invalid or incomplete (in this case, it is probably a version mismatch between the client-side and server-side library).</li></ul></td>
</tr>
<tr>
<td>404</td>
<td>Not Found: the proxy cannot access the resource on the remote server. This can be caused by several things: <ul><li>the URL is wrong or it cannot be accessed from the proxy server,</li><li>the remote server encountered an error (5XX),</li><li>the remote server requires to be authenticated to access the resource,</li><li>...</li></ul> Please note that the proxy server cannot follow redirection (3XX), so this will also end with a 404 status code.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed: you tried to make a request using a method that is not in the server&#39;s <code>allowedMethods</code> list.</td>
</tr>
<tr>
<td>406</td>
<td>The mimetype of the requested resource is not in the <code>allowedMimes</code> list that was sent with the request (<code>httpRequest.get*Proxy(url, {allowedMimes: [...]})</code>).</td>
</tr>
<tr>
<td>413</td>
<td>Too Large: the requested resource is larger than the server&#39;s <code>maxContentLength</code> configuration.</td>
</tr>
<tr>
<td>500</td>
<td>An error occurred in the proxy server.</td>
</tr>
</tbody></table>
<h2 id="client-side-configuration">Client-Side Configuration</h2>
<p>By default the client library assumes that the proxy URL is <code>/proxy</code>. If you
change this route in your server-side implementation, you will have to
configure it on the client side:</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> httpRequest = <span class="hljs-built_in">require</span>(<span class="hljs-string">"obsidian-http-request"</span>);
httpRequest.proxyPath = <span class="hljs-string">"/custom/proxy-route"</span>;</code></pre>


<h2 id="simple-requests-http-get">Simple Requests (HTTP GET)</h2>
<p>When you just want to fetch assets, you can use simplified <code>get*Proxy</code> methods,
depending on what kind of data you retrieve.</p>
<p>To make a request, just require the module and use the method that best fit
your need.</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> httpRequest = <span class="hljs-built_in">require</span>(<span class="hljs-string">"obsidian-http-request"</span>);</code></pre>

<p>All the following methods can take an additional argument to configure some
behavior of the proxy:</p>
<pre><code class="hljs javascript">httpRequest.get*<span class="hljs-built_in">Proxy</span>(url, {
    <span class="hljs-attr">headers</span>: {},      <span class="hljs-comment">// Additional custom HTTP headers</span>
    allowedMimes: []  <span class="hljs-comment">// Prevent the proxy to download data types that</span>
                      <span class="hljs-comment">//   are not listed here</span>
}).then(...);</code></pre>

<h3 id="httprequestgettextproxy">httpRequest.getTextProxy</h3>
<p>This method can be used to retrieve text. It returns a <code>String</code>.</p>
<pre><code class="hljs javascript">httpRequest.getTextProxy(<span class="hljs-string">"http://www.example.com/hello.txt"</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-built_in">console</span>.log(result);  <span class="hljs-comment">// -&gt; String</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-built_in">console</span>.error(error);
    });</code></pre>

<h3 id="httprequestgetjsonproxy">httpRequest.getJsonProxy</h3>
<p>This method can be used to retrieve JSON. It returns native Javascript objects
from the JSON.</p>
<pre><code class="hljs javascript">httpRequest.getJsonProxy(<span class="hljs-string">"http://www.example.com/hello.json"</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-built_in">console</span>.log(result);  <span class="hljs-comment">// -&gt; {}</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-built_in">console</span>.error(error);
    });</code></pre>

<h3 id="httprequestgetrawproxy">httpRequest.getRawProxy</h3>
<p>This method can be used to retrieve raw (possibly binary) data. It returns
a <a href="https://nodejs.org/api/buffer.html">Node.js <code>Buffer</code></a>.</p>
<pre><code class="hljs javascript">httpRequest.getRawProxy(<span class="hljs-string">"http://www.example.com/hello.zip"</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-built_in">console</span>.log(result);  <span class="hljs-comment">// -&gt; Node.js Buffer</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-built_in">console</span>.error(error);
    });</code></pre>

<h3 id="httprequestgetblobproxy">httpRequest.getBlobProxy</h3>
<p>This method can be used to retrieve data as a Blob. It returns a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob"><code>Blob</code></a>.</p>
<pre><code class="hljs javascript">httpRequest.getBlobProxy(<span class="hljs-string">"http://www.example.com/hello.png"</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-built_in">console</span>.log(result);  <span class="hljs-comment">// -&gt; Blob</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-built_in">console</span>.error(error);
    });</code></pre>

<h2 id="advanced-requests">Advanced Requests</h2>
<p>Obsidian HTTP Request provides a method to allow you to send more advanced
requests (if you have to use a different method than <code>GET</code>, custom headers,
body,...).</p>
<p>Here is an example of how to send and receive JSON data:</p>
<pre><code class="hljs javascript">httpRequest.requestProxy(<span class="hljs-string">"http://www.example.com/do-something"</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>,
        <span class="hljs-string">"x-foo"</span>: <span class="hljs-string">"bar"</span>
    },
    <span class="hljs-attr">body</span>: Buffer.from(<span class="hljs-built_in">JSON</span>.stringify({<span class="hljs-attr">foo</span>: <span class="hljs-string">"bar"</span>})),  <span class="hljs-comment">// body must be a Node Buffer or null</span>
    allowedMimes: [<span class="hljs-string">"application/json"</span>]                <span class="hljs-comment">// Only allows JSON response</span>
})
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resultBuffer</span>) </span>{                    <span class="hljs-comment">// response is also a Node Buffer</span>
        <span class="hljs-keyword">var</span> result = <span class="hljs-built_in">JSON</span>.parse(resultBuffer.toString());
        <span class="hljs-built_in">console</span>.log(result);
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-built_in">console</span>.error(error);
    });</code></pre>

<h2 id="catching-errors">Catching errors</h2>
<p>Thown errors provide access to status code and message</p>
<pre><code class="hljs javascript">httpRequest.getTextProxy(<span class="hljs-string">"http://www.example.com/404.txt"</span>)
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-built_in">console</span>.error(error.statusCode); <span class="hljs-comment">// 404</span>
        <span class="hljs-built_in">console</span>.error(error.statusMessage); <span class="hljs-comment">// "Not Found"</span>
    });</code></pre>
<p>Cause error can be accessed for errors while parsing json response</p>
<pre><code class="hljs javascript">httpRequest.getJsonProxy(<span class="hljs-string">"http://www.example.com/invalid.json"</span>)
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-built_in">console</span>.error(error); <span class="hljs-comment">// Error "NotAValidJson"</span>
        <span class="hljs-built_in">console</span>.error(error.cause); <span class="hljs-comment">// Error "SyntaxError"</span>
    });</code></pre>


                </article>
            </div>

            <footer>
                Copyright (c)  2025 Wanadev
- <a href="http://www.wanadev.fr/">www.wanadev.fr</a><br />
Unless otherwise specified, this documentation is published under the
<a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en">cc by-sa 3.0</a> license<br />
Generated using <a href="https://wanadev.github.io/enlightme/\">Enlight'me</a> 0.2.0

            </footer>

        </div>

        <script>

(function() {

    var MENU_UNFOLDED_CLASS = "mobile-menu-unfolded";

    var menuButton = document.getElementById("toggle-mobile-menu");
    var menuItems = document.querySelectorAll(".content nav a");

    function getAbsolutePosition(element) {
        if (typeof(element) == "string") {
            element = document.getElementById(element);
        }
        if (!(element instanceof Element)) {
            return {x: 0, y: 0};
        }

        var css;
        var origElement = element;

        try {
            css = getComputedStyle(element);
        } catch (e) {
            return {x: 0, y: 0};
        }

        if (!css) {
            return {x: 0, y: 0};
        }

        var x = -parseInt(css.borderLeftWidth);
        var y = -parseInt(css.borderTopWidth);

        while (element.offsetParent) {
            css = getComputedStyle(element);

            x += element.offsetLeft || 0;
            x += parseInt(css.borderLeftWidth);

            y += element.offsetTop || 0;
            y += parseInt(css.borderTopWidth);

            element = element.offsetParent;
        }

        element = origElement;

        while (element.parentNode && !(element instanceof HTMLBodyElement)) {
            x -= element.scrollLeft || 0;
            y -= element.scrollTop || 0;
            element = element.parentNode;
        }

        return {x: x, y: y};
    };

    function openMenu() {
        document.body.classList.add(MENU_UNFOLDED_CLASS);
    }

    function closeMenu() {
        document.body.classList.remove(MENU_UNFOLDED_CLASS);
    }

    function toggleMenu() {
        document.body.classList.toggle(MENU_UNFOLDED_CLASS);
    }

    function _onMenuItemClicked(event) {
        var href = this.getAttribute("href");

        if (href[0] != "#") {
            return;
        }

        event.preventDefault();

        var anchor = href.substr(1, href.length-1);
        var anchorPosition = getAbsolutePosition(anchor);
        document.scrollingElement.scrollTop = anchorPosition.y - menuButton.offsetHeight;

        closeMenu();
    }

    menuButton.onclick = toggleMenu;
    menuItems.forEach(function(item) {
        item.onclick = _onMenuItemClicked;
    });

})();

</script>

    </body>

</html>
